//  names start with cap are states
//  names start with app:: are appliction handlers
//  names start with dum:: are dum interface to application
//  names start with lower case are actions
//  names start with on are events

digraph UAC {
    rankdir=LR;
    node [shape = box];

    // create a timer in the DialogSet when 1xx is received including 100
    Start -> Early                          [ label = "on1xx/app::onNewSession,app::onProvisional" ];
    Start -> Early                          [ label = "on1xx-early/app::onNewSession,app::onProvisional,app::onEarly" ];
    Start -> EarlyWithOffer                 [ label = "on1xx-offer/app::onOffer" ];
    Start -> EarlyWithAnswer                [ label = "on1xx-answer/app::onNewSession,app::onAnswer,PRACK" ];
    Start -> WaitingForAnswerFromApp        [ label = "on2xx-offer/app::onOffer" ];
    Start -> Connected                      [ label = "on2xx-answer/send::ACK" ];
    Start -> Terminated                     [ label = "on2xx/send::ACK,send::BYE,app::onFailure" ];
    Start -> Terminated                     [ label = "onInviteFailure|onGeneralFailure/app::onFailure" ];
    Start -> Terminated                     [ label = "onRedirect/app::onRedirected" ];

    Early -> Early                          [ label = "on1xx/app::onProvisional" ];
    Early -> Early                          [ label = "on1xx-early/app::onProvisional,app::onEarly" ];
    Early -> EarlyWithAnswer                [ label = "on1xx-answer/app::onAnswer,send::PRACK" ];
    Early -> EarlyWithOffer                 [ label = "on1xx-offer/app::onOffer" ];
    Early -> WaitingForAnswerFromApp        [ label = "on2xx-offer/app::onOffer" ];
    Early -> Connected                      [ label = "on2xx-answer/send::ACK" ];
    Early -> Terminated                     [ label = "on2xx/send::ACK,send::BYE" ];
    Early -> Finish                         [ label = "onGeneralFailure" ];
    Early -> Terminated                     [ label = "onRedirect/app::onRedirected" ];
    Early -> Canceled                       [ label = "dum::cancel/send::CANCEL,timer" ];
    Early -> Terminated                     [ label = "dum::provideAnswer/assert(0)" ];
    Early -> Terminated                     [ label = "dum::provideOffer/assert(0)" ];

    EarlyWithOffer -> Connected             [ label = "on2xx-answer/send::ACK" ];
    EarlyWithOffer -> Terminated            [ label = "onRedirect/app::onRedirected" ];
    //  Ken's note:
    //  Rohan says, the first 180 an UAS is to respond to an INVITE w/offer, must contain an answer.
    EarlyWithOffer -> PrackAnswerWait       [ label = "dum::provideAnswer/send::PRACK" ];
    EarlyWithOffer -> Terminated            [ label = "dum::provideOffer/assert(0)" ];
    EarlyWithOffer -> Canceled              [ label = "dum::cancel/send::CANCEL,timer" ];

    EarlyWithAnswer -> Connected            [ label = "on2xx/send::ACK" ];
    EarlyWithAnswer -> EarlyWithAnswer      [ label = "on1xx/send::PRACK" ];
    EarlyWithAnswer -> EarlyWithAnswer      [ label = "on1xx-answer-retran/resend::lastPRACK" ];
    // Can I send the UPDATE before I get 200/PRACK
    EarlyWithAnswer -> ReceivedUpdateEarly  [ label = "onUPDATE/app::onOffer" ];
    EarlyWithAnswer -> Terminated           [ label = "on2XX-answer/send::ACK,send::BYE" ];
    EarlyWithAnswer -> Finished             [ label = "onGeneralFailure" ];
    EarlyWithAnswer -> Terminated           [ label = "dum::provideAnswer/assert(0)" ];
    EarlyWithAnswer -> SentUpdateEarly      [ label = "dum::povideOffer/send::UPDATE" ];
    EarlyWithAnswer -> Canceled             [ label = "dum::cancel/send::CANCEL,timer" ];
    EarlyWithAnswer -> Terminated           [ label = "onRedirect/app::onRedirected" ];

    SentUpdateEarly -> EarlyWithAnswer      [ label = "on200U/app::onAnswer" ];
    SentUpdateEarly -> EarlyWithAnswer      [ label = "onUPDATE/489glare" ];
    SentUpdateEarly -> EarlyWithAnswer      [ label = "on489/glare" ];
    SentUpdateEarly -> SentUpdateConnected  [ label = "on2xxI/send::ACK" ];
    SentUpdateEarly -> Finish               [ label = "onGeneralFailure" ];
    SentUpdateEarly -> Canceled             [ label = "dum::cancel/send::CANCEL,timer" ];
    SentUpdateEarly -> Terminated           [ label = "dum::provideAnswer/assert(0)" ];
    SentUpdateEarly -> Terminated           [ label = "dum::provideOffer/assert(0)" ];
    SentUpdateEarly -> Terminated           [ label = "onRedirect/app::onRedirected" ];

    SentUpdateConnected -> Connected        [ label = "on200U/app::onAnswer" ];
    SentUpdateConnected -> Connected        [ label = "on488U/app::onRejected" ];
    SentUpdateConnected -> Connected        [ label = "on489U/glare" ];
    SentUpdateConnected -> Terminated       [ label = "dum::cancel/assert(0)" ];
    SentUpdateConnected -> Terminated       [ label = "dum::provideAnswer/assert(0)" ];
    SentUpdateConnected -> Terminated       [ label = "dum::provideOffer/assert(0)" ];

    ReceivedUpdateEarly -> Terminated       [ label = "onRedirect/app::onRedirected" ];
    ReceivedUpdateEarly -> EarlyWithAnswer  [ label = "dum::provideAnswer/send::200U-answer" ];
    ReceivedUpdateEarly -> EarlyWithAnswer  [ label = "dum::reject/send::488U" ];
    ReceivedUpdateEarly -> Canceled         [ label = "dum::cancel/send::CANCEL,timer" ];
    ReceivedUpdateEarly -> Terminated       [ label = "dum::provideAnswer/assert(0)" ];
    ReceivedUpdateEarly -> Terminated       [ label = "dum::provideOffer/assert(0)" ];

    WaitingForAnswerFromApp -> Connected    [ label = "dum::provideAnswer/send::ACK-answer" ];
    WaitingForAnswerFromApp -> Terminated   [ label = "onRedirect/app::onRedirected" ];
    WaitingForAnswerFromApp -> Canceled     [ label = "dum::cancel/send::CANCEL,timer" ];
    WaitingForAnswerFromApp -> Terminated   [ label = "dum::provideAnswer/assert(0)" ];
    WaitingForAnswerFromApp -> Terminated   [ label = "dum::provideOffer/assert(0)" ];

    PrackAnswerWait -> EarlyWithAnswer      [ label = "dum::provideOffer/queueOffer" ];
    PrackAnswerWait -> SentUpdateEarly      [ label = "on200P-queued/UPDATE-queued" ];
    PrackAnswerWait -> EarlyWithAnswer      [ label = "on200P-notQueued" ];
    PrackAnswerWait -> Connected            [ label = "on2xxI/send::ACK" ];
    PrackAnswerWait -> Terminated           [ label = "onRedirect/app::onRedirected" ];
    PrackAnswerWait -> EarlyWithAnswer      [ label = "dum::provideOffer/queueOffer" ];

    PrackAnswerWait -> Canceled             [ label = "dum::cancel/send::CANCEL,timer" ];
    PrackAnswerWait -> Terminated           [ label = "dum::provideAnswer/assert(0)" ];
    PrackAnswerWait -> Terminated           [ label = "dum::provideOffer/assert(0)" ];

    Canceled -> Finished                    [ label = "onTimer" ];
    Canceled -> Finished                    [ label = "onGeneralFailure" ];
    Canceled -> Finished                    [ label = "on4xxC" ];
    Canceled -> Terminated                  [ label = "on200I/send::BYE" ];
    Canceled -> Canceled                    [ label = "no-op" ];
    Canceled -> Terminated                  [ label = "onRedirect/app::onRedirected" ];

    Connected -> Terminated                 [ label = "dum::end/send::BYE" ];
    Connected -> Finish                     [ label = "on2xxB" ];

    Terminated -> Finish                    [ label = "2XX BYE" ];
}
