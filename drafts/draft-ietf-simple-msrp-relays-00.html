<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Relay Extensions for Message Sessions Relay Protocol (MSRP)</title>
<meta name="description" content="Relay Extensions for Message Sessions Relay Protocol (MSRP)">
<meta name="keywords" content="I-D, Internet-Draft, MSRP">
<meta name="generator" content="xml2rfc v1.22 (http://xml.resource.org/)">
<style type='text/css'>
<!--
    body {
        font-family: verdana, charcoal, helvetica, arial, sans-serif;
        font-size: small ; color: #000000 ; background-color: #ffffff ; }
    .title { color: #990000; font-size: x-large ;
        font-weight: bold; text-align: right;
        font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
        background-color: transparent; }
    .filename { color: #666666; font-size: 18px; line-height: 28px;
        font-weight: bold; text-align: right;
        font-family: helvetica, arial, sans-serif;
        background-color: transparent; }
    td.rfcbug { background-color: #000000 ; width: 30px ; height: 30px ; 
        text-align: justify; vertical-align: middle ; padding-top: 2px ; }
    td.rfcbug span.RFC { color: #666666; font-weight: bold; text-decoration: none;
        background-color: #000000 ;
        font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
        font-size: x-small ; }
    td.rfcbug span.hotText { color: #ffffff; font-weight: normal; text-decoration: none;
        text-align: center ;
        font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
        font-size: x-small ; background-color: #000000; }

     A { font-weight: bold; }
     A:link { color: #990000; background-color: transparent ; }
     A:visited { color: #333333; background-color: transparent ; }
     A:active { color: #333333; background-color: transparent ; }

    p { margin-left: 2em; margin-right: 2em; }
    p.copyright { font-size: x-small ; }
    p.toc { font-size: small ; font-weight: bold ; margin-left: 3em ;}

    span.emph { font-style: italic; }
    span.strong { font-weight: bold; }
    span.verb { font-family: "Courier New", Courier, monospace ; }

    ol.text { margin-left: 2em; margin-right: 2em; }
    ul.text { margin-left: 2em; margin-right: 2em; }
    li { margin-left: 3em;  }

    pre { margin-left: 3em; color: #333333;  background-color: transparent;
        font-family: "Courier New", Courier, monospace ; font-size: small ;
        }

    h3 { color: #333333; font-size: medium ;
        font-family: helvetica, arial, sans-serif ;
        background-color: transparent; }
    h4 { font-size: small; font-family: helvetica, arial, sans-serif ; }

    table.bug { width: 30px ; height: 15px ; }
    td.bug { color: #ffffff ; background-color: #990000 ;
        text-align: center ; width: 30px ; height: 15px ;
         }
    td.bug A.link2 { color: #ffffff ; font-weight: bold;
        text-decoration: none;
        font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
        font-size: x-small ; background-color: transparent }

    td.header { color: #ffffff; font-size: x-small ;
        font-family: arial, helvetica, sans-serif; vertical-align: top;
        background-color: #666666 ; width: 33% ; }
    td.author { font-weight: bold; margin-left: 4em; font-size: x-small ; }
    td.author-text { font-size: x-small; }
    table.data { vertical-align: top ; border-collapse: collapse ;
        border-style: solid solid solid solid ;
        border-color: black black black black ;
        font-size: small ; text-align: center ; }
    table.data th { font-weight: bold ;
        border-style: solid solid solid solid ;
        border-color: black black black black ; }
    table.data td {
        border-style: solid solid solid solid ;
        border-color: #333333 #333333 #333333 #333333 ; }

    hr { height: 1px }
-->
</style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIMPLE WG</td><td class="header">C. Jennings</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">R. Mahy</td></tr>
<tr><td class="header">Expires: October 19, 2004</td><td class="header">Cisco Systems, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">April 20, 2004</td></tr>
</table></td></tr></table>
<div align="right"><span class="title"><br />Relay Extensions for Message Sessions Relay Protocol (MSRP)</span></div>
<div align="right"><span class="title"><br />draft-ietf-simple-msrp-relays-00.txt</span></div>

<h3>Status of this Memo</h3>
<p>
This document is an Internet-Draft and is
in full conformance with all provisions of Section 10 of RFC2026.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as "work in progress."</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 19, 2004.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (C) The Internet Society (2004). All Rights Reserved.</p>

<h3>Abstract</h3>

<p>
The SIMPLE Working Group uses two separate models for conveying instant messages.  Pager-mode messages stand alone, whereas Session-mode messages are setup as part of a session using the SIP protocol. MSRP (Message Sessions Relay Protocol) is a protocol for near-real-time, peer-to-peer exchange of binary content without intermediaries, which is designed to be signaled using a separate rendezvous protocol such as SIP.  This document introduces the notion of message relay intermediaries to MSRP and describes the extensions necessary to use them.          

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Conventions and Definitions<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction and Requirements<br />
<a href="#anchor3">3.</a>&nbsp;
Protocol Overview<br />
<a href="#anchor4">4.</a>&nbsp;
New Protocol Elements<br />
<a href="#anchor5">4.1</a>&nbsp;
The AUTH Method<br />
<a href="#anchor6">4.2</a>&nbsp;
The Use-Path header<br />
<a href="#anchor7">4.3</a>&nbsp;
Authentication headers<br />
<a href="#anchor8">4.4</a>&nbsp;
Time-related headers<br />
<a href="#anchor9">5.</a>&nbsp;
Procedures<br />
<a href="#anchor10">5.1</a>&nbsp;
Client behavior<br />
<a href="#anchor11">5.1.1</a>&nbsp;
Connecting to relays acting on your behalf<br />
<a href="#anchor12">5.1.2</a>&nbsp;
Sending requests<br />
<a href="#anchor13">5.1.3</a>&nbsp;
Receiving Requests<br />
<a href="#anchor14">5.1.4</a>&nbsp;
Managing Connections<br />
<a href="#anchor15">5.2</a>&nbsp;
Relay behavior<br />
<a href="#anchor16">5.2.1</a>&nbsp;
Handling Incoming Connections<br />
<a href="#anchor17">5.2.2</a>&nbsp;
Generic request behavior<br />
<a href="#anchor18">5.2.3</a>&nbsp;
Receiving AUTH requests<br />
<a href="#anchor19">5.2.4</a>&nbsp;
Forwarding SEND requests<br />
<a href="#anchor20">5.2.5</a>&nbsp;
Forwarding non-SEND requests<br />
<a href="#anchor21">5.2.6</a>&nbsp;
Forwarding Responses<br />
<a href="#anchor22">5.2.7</a>&nbsp;
Managing Connections<br />
<a href="#anchor23">5.2.8</a>&nbsp;
Forwarding unknown requests<br />
<a href="#anchor24">5.3</a>&nbsp;
Acting as a Message Taker<br />
<a href="#anchor25">6.</a>&nbsp;
Formal Syntax<br />
<a href="#srv">7.</a>&nbsp;
Finding MSRP Servers<br />
<a href="#anchor26">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor27">8.1</a>&nbsp;
Using HTTP Authentication<br />
<a href="#anchor28">8.2</a>&nbsp;
Using TLS<br />
<a href="#anchor29">8.3</a>&nbsp;
Threat Model<br />
<a href="#anchor30">8.4</a>&nbsp;
Security Mechanism <br />
<a href="#anchor31">8.5</a>&nbsp;
Preventing Spam and Denial of Service Attacks<br />
<a href="#anchor32">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor33">10.</a>&nbsp;
Example SDP with multiple hops<br />
<a href="#anchor34">11.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">&#167;</a>&nbsp;
Normative References<br />
<a href="#rfc.references2">&#167;</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;Conventions and Definitions</h3>

<p>
  The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
  "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
  interpreted as described in <a href="#RFC2119" title="Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997."quot;">RFC-2119</a>[1].

</p>
<p>
Below we list several definitions important to MSRP:
</p>
<blockquote class="text"><dl>
<dt></dt>
<dd><span class="strong">MSRP node:</span> A host that implements the MSRP protocols as a Client or a Relay

</dd>
<dt></dt>
<dd><span class="strong">MSRP Client:</span> A MSRP role which is the initial sender or final target of messages and delivery status.

</dd>
<dt></dt>
<dd><span class="strong">MSRP Relay:</span> A MSRP role which forwards messages and delivery status and may provide policy enforcement.  Relays MAY fragment and reassemble portions of messages.

</dd>
<dt></dt>
<dd><span class="strong">Message-Taker:</span> A MSRP Client which persistently stores messages on behalf of specific users or resources

</dd>
<dt></dt>
<dd><span class="strong">message:</span> arbitrary MIME content which one client wishes to send to another. For the purposes of this specification, a complete MIME body as opposed to a portion of a complete message.

</dd>
<dt></dt>
<dd><span class="strong">message fragment:</span> a portion of a complete message carried in (for example) a message/byteranges MIME type.

</dd>
<dt></dt>
<dd><span class="strong">message:</span> binary MIME content of an arbitrary type. Each message has a unique message-id.  In MSRP, messages may be broken up into pieces and sent in separate SEND requests.

</dd>
<dt></dt>
<dd><span class="strong">end-to-end:</span> delivery of data from the initiating client to the final target client

</dd>
<dt></dt>
<dd><span class="strong">hop:</span> delivery of data between one MSRP node and an adjacent node.

</dd>
<dt></dt>
<dd><span class="strong">transaction:</span> a request and response as seen from a single MSRP node.  Each transaction has a locally significant transaction identifier.

</dd>
</dl></blockquote>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;Introduction and Requirements</h3>

<p>
The IETF SIMPLE Working Group has identified a number of scenarios where using a
separate protocol for bulk messaging is desirable. In particular, the SIMPLE WG
will use this facility to handle a sequence of messages as a session of media initiated using <a href="#RFC3261" title="Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M. and E. Schooler, SIP: Session Initiation Protocol, June 2002."quot;">SIP</a>[2], just
like any other media type.  (The benefits of the session-mode approach are further discussed in <a href="#I-D.mahy-simple-why-session-mode" title="Mahy, R., Benefits of Session-Mode Instant Messaging, February 2004."quot;">[19]</a>.) 
The SIMPLE Working Group has also developed MSRP (the Message Sessions Relay Protocol) to convey sessions of messages directly between two end systems with no intermediaries.  With MSRP, messages can be arbitrarily large and all traffic is sent over reliable, congestion-safe transports.

</p>
<p>
This document describes extensions to the core MSRP protocol to introduce intermediaries called Relays.  With these extensions MSRP clients can communicate directly, or through an arbitrary number of relays.  Each client is responsible for identifying any relays acting on its behalf and providing appropriate credentials.  Clients which can receive new TCP connections directly do not have to implement any new functionality to work with these relays.

</p>
<p>
This document is far from complete, but was submitted to allow the SIMPLE WG to understand the proposed concept and bring up issues with the general approach.
 
</p>
<p>
The Goals of the MSRP Relay extensions are listed below:
</p>
<ul class="text">
<li> convey arbitrary binary MIME data without modification or transfer encoding

</li>
<li> continue to support client to client operation (no relay servers required)

</li>
<li> operate through an arbitrary number of relays for policy enforcement

</li>
<li> allow each client to control which relays are traversed on its behalf

</li>
<li> prevent unsolicited messages (spam), "open relays", and denial of
service amplification

</li>
<li> allow relays to use one or a small number of TCP or <a href="#RFC2246" title="Dierks, T., Allen, C., Treese, W., Karlton, P., Freier, A. and P. Kocher, The TLS Protocol Version 1.0, January 1999."quot;">TLS</a>[3] connections to
carry messages for multiple sessions, recipients, and senders

</li>
<li> allow large messages to be sent over a slow connection without causing
head-of-line blocking problems

</li>
<li> allow transmission of a large message to be interrupted and resumed in
place when network connectivity is lost and later reestablished

</li>
<li> offer notification of message failure at any intermediary

</li>
<li> provide notification of message storage (desirable)

</li>
<li> allow relays to delete state after a short amount of time

</li>
</ul>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;Protocol Overview</h3>

<p>
With the introduction of this extension, MSRP has the concept of both clients and relays.  Clients send messages to relays
and/or other clients.  Relays forward messages and message delivery status to
clients and other relays.  Clients which can open TCP connections to each other
without intervening policy restrictions, can communicate directly with each
other.  Clients who are behind a firewall or who need to use an intermediary for
policy reasons can use the services of a relay.  Each client is responsible for
enlisting the assistance of one or more relays for its half of the
communication. 

</p>
<p>
We also define the special role of a Message-Taker, which is a client that
can receive messages and store them persistently on behalf of a user.  Note that
these roles can be co-resident. 

</p>
<p>
Clients which use a relay operate by first opening a connection with a relay,
authenticating, and retreiving a URI on the relay the client can provide to its peers to receive messages later.  
When a client uses a relay, it first opens a TLS connection to its first relay and authenticates using an AUTH request which can contain <a href="#RFC2617" title="Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A. and L. Stewart, HTTP Authentication: Basic and Digest Access Authentication, June 1999."quot;">HTTP Digest or Basic</a>[4] Authentication credentials.  In a successful AUTH response, the relay provides an MSRP URI associated with the path back to the client that the client can give to other clients for end-to-end message delivery.

</p>
<p>
When clients wish to send a short message, they send a SEND request with the
entire contents of the message. If any relays are required, they are included in the To-Path header. The leftmost URI in the To-Path header is the next hop to deliver a request or response.  The rightmost URI in the To-Path header is the final target.

</p><pre>
 MSRP SEND
 Tr-ID: 892341
 To-Path: msrp:example.org:9000/kjfjan \
  msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 From-Path: msrp:alice.example.com:7965/bar
 Boundary: 6aef
 Content-Type: text/plain

 Hi Bob, I'm about to send you LoTR.mpeg
 -------6aef$
 
 
 MSRP 200 OK
 Tr-ID: 892341
 To-Path: msrp:alice.example.com:7965/bar
 From-Path: msrp:example.org:9000/kjfjan
 
 MSRP SEND
 Tr-ID: 132452
 To-Path: msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 From-Path: msrp:example.org:9000/kjfjan \
  msrp:alice.example.com:7965/bar
 Boundary: 6aef
 Content-Type: text/plain

 Hi Bob, I'm about to send you LoTR.mpeg
 -------6aef$

 MSRP 200 OK
 Tr-ID: 132452
 To-Path: msrp:example.org:9000/kjfjan
 From-Path: msrp:magic-coookie@example.net:9000/aeiug

 MSRP SEND
 Tr-ID: 0987231
 To-Path: msrp:bob.example.net:8145/foo
 From-Path: msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:example.org:9000/kjfjan \
  msrp:alice.example.com:7965/bar
 Boundary: 6aef
 Content-Type: text/plain

 Hi Bob, I'm about to send you LoTR.mpeg
 -------6aef$

 MSRP 200 OK
 Tr-ID: 0987231
 To-Path: msrp:magic-coookie@example.net:9000/aeiug 
 From-Path: msrp:bob.example.net:8145/foo
 
 MSRP REPORT
 Tr-ID: 784333
 To-Path: msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:example.org:9000/kjfjan \
  msrp:alice.example.com:7965/bar
 From-Path: msrp:bob.example.net:8145/foo
 Receipt: success

 MSRP REPORT
 Tr-ID: 784333
 To-Path: msrp:example.org:9000/kjfjan \
  msrp:alice.example.com:7965/bar
 From-Path: msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 Receipt: success

 MSRP REPORT
 Tr-ID: 784333
 To-Path: msrp:alice.example.com:7965/bar
 From-Path: msrp:example.org:9000/kjfjan \
  msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 Receipt: success

 MSRP 200 OK
 Tr-ID: 784333
 To-Path: msrp:example.org:9000/kjfjan \
  msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 From-Path: msrp:alice.example.com:7965/bar
 Receipt: success

 MSRP 200 OK
 Tr-ID: 784333
 To-Path: msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:bob.example.net:8145/foo
 From-Path: msrp:example.org:9000/kjfjan \
  msrp:alice.example.com:7965/bar
 Receipt: success

 MSRP 200 OK
 Tr-ID: 784333
 To-Path: msrp:bob.example.net:8145/foo
 From-Path: msrp:example.org:9000/kjfjan \
  msrp:magic-coookie@example.net:9000/aeiug \ 
  msrp:alice.example.com:7965/bar
 Receipt: success

</pre>
<pre>
                    Typical flow involving two relays

Alice              a.example.org       b.example.net             Bob
  |                     |                    |                     |
  |::::::::::::::::::::&gt;| connection opened  |&lt;::::::::::::::::::::|
  |--- AUTH -----------&gt;|                    |&lt;-- AUTH ------------|
  |&lt;-- 401 Auth---------|                    |--- 401 Auth--------&gt;|
  |--- AUTH -----------&gt;|                    |&lt;-- AUTH ------------|
  |&lt;-- 200 OK-----------|                    |--- 200 OK----------&gt;|
  |                     |                    |                     |
        ....                time passes           ....
  |                     |                    |                     |
  |--- SEND -----------&gt;|                    |                     |
  |&lt;-- 200 OK ----------|:::::::::::::::::::&gt;|  (slow link)        |
  |                     |--- SEND ----------&gt;|                     |
  |                     |&lt;-- 200 OK ---------|--- SEND -----------&gt;|
  |                     |                    |                ....&gt;|
  |                     |                    |                  ..&gt;|
  |                     |                    |&lt;-- 200 OK ----------|
  |                     |                    |&lt;-- REPORT ----------|
  |                     |&lt;-- REPORT ---------|                     |
  |&lt;-- REPORT ----------|                    |                     |
  |--- 200 OK ---------&gt;|                    |                     |
  |                     |--- 200 OK --------&gt;|                     |
  |                     |                    |--- 200 OK ---------&gt;|
  |                     |                    |                     |
</pre>

<p>
SEND requests are sent hop-by-hop.    
(Each relay that receives a SEND request
acknowledges receipt of the request before forwarding the content in other SEND requests.)  
All other requests are sent end-to-end. 

</p>
<p>
With the introduction of relays, the subtle semantics of the To-Path and From-Path header becomes more relevant.

The To-Path in both requests and responses is the list of URIs that need to be visited in order to reach the final target of the request.  The From-Path is the list of URIs that indicate how to get back to the original sender of the request or response (Note these semantics are slightly different for SEND requests). 

This differs from the To and From headers in SIP, which do not "swap" from request to response.

(Note that sometimes a request is sent to or from an intermediary directly.)

</p>
<p>
When a relay forwards a request, it removes its address from the To-Path header and inserts it at as the first URI in the From-Path header.  For example if the path from Alice to Bob is through relays A and B, when B receives the request it contains path headers that look like this:

</p><pre>
To-Path: msrp:B msrp:Bob
From-Path: msrp:A msrp:Alice
</pre>

<p>
after forwarding the request, the path headers look like this:

</p><pre>
To-Path: msrp:Bob
From-Path: msrp:B msrp:A msrp:Alice
</pre>

<p>
MSRP Nodes respond to SEND requests by taking the first URI form the From-Path and placing that in a To-Path header in the response, and placing their URI in the From-Path of the response.  MSRP Nodes response to all other requests addressed to them, by swapping the To-Path and From-Path headers.

</p>
<p>
When sending large content the client may split up a messsage into smaller pieces;
each SEND request might contain only a portion of the complete message.  For example, when
Alice sends Bob a 4GB file called "LoTR.mpeg", she sends
several SEND requests each with a portion of the complete message.
Relays can repack message fragments en-route.  As individual parts of the complete message arrive at the final destination client, the receiving client can optionally send REPORT requests indicating delivery status.

</p>
<p>
MSRP nodes can send individual portions of a complete message in multiple SEND requests.  Each parcel uses the message/byteranges MIME type
defined in <a href="#RFC2616" title="Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P. and T. Berners-Lee, Hypertext Transfer Protocol -- HTTP/1.1, June 1999."quot;">RFC 2616</a>[5] to correlate that part to the complete message.  As each SEND request is
received, the next hop acknowledges the request. As relays receive parcels they
can reassemble or re-fragment them as long as each chunk is sent in order.
Once a chunk or complete message arrives at the destination client, the
destination can optionally send a REPORT request indicating that a chunk arrived end-to-end.
This request travels back along the reverse path of the SEND request.  Unlike
the SEND request which is acknowledged along every hop, only the sender of
the REPORT request responds to an REPORT.  Relays then forward the REPORT
response back to the recipient of the original SEND.  

</p><pre>
               Flow involving re-chunking through two relays

Alice              a.example.org       b.example.net             Bob
  |                     |                    |                     |
  |                     |                    |                     |
  |--- AUTH -----------&gt;|                    |&lt;-- AUTH ------------|
  |&lt;-- 401 Auth---------|                    |--- 401 Auth--------&gt;|
  |--- AUTH -----------&gt;|                    |&lt;-- AUTH ------------|
  |&lt;-- 200 OK-----------|                    |--- 200 OK----------&gt;|
  |                     |                    |                     |
        ....                time passes           ....
  |                     |                    |                     |
  |--- SEND 0-3 -------&gt;|                    |                     |
  |&lt;-- 200 OK ----------|                    |  (slow link)        |
  |--- SEND 4-7 -------&gt;|--- SEND 0-5 ------&gt;|                     |
  |&lt;-- 200 OK ----------|&lt;-- 200 OK ---------|--- SEND 0-3 -------&gt;|
  |--- SEND 8-10 ------&gt;|--- SEND 6-10 -----&gt;|                ....&gt;|
  |&lt;-- 200 OK ----------|&lt;-- 200 OK ---------|                  ..&gt;|
  |                     |                    |&lt;-- 200 OK ----------|
  |                     |                    |&lt;-- REPORT 0-3 ------|
  |                     |&lt;-- REPORT 0-3 -----|--- SEND 4-7 -------&gt;|
  |&lt;-- REPORT 0-3 ------|                    |                 ...&gt;|
  |--- 200 OK ---------&gt;|                    |                  ..&gt;|
  |                     |--- 200 OK --------&gt;|                     |
  |                     |                    |--- 200 OK ---------&gt;|
  |                     |                    |&lt;-- REPORT 4-7 -----&gt;|
  |                     |&lt;-- REPORT 4-7 -----|--- SEND 8-10 ------&gt;|
  |&lt;-- REPORT 4-7 ------|                    |                  ..&gt;|
  |--- 200 OK ---------&gt;|                    |&lt;-- 200 OK ----------|
  |                     |&lt;-- REPORT done-----|&lt;-- REPORT done -----|
  |&lt;-- REPORT done -----|--- 200 OK --------&gt;|                     |
  |--- 200 OK ---------&gt;|                    |--- 200 OK ---------&gt;|
  |                     |--- 200 OK --------&gt;|                     |
  |                     |                    |--- 200 OK ---------&gt;|
  |                     |                    |                     |
</pre>

<p>
Relays only keep transaction state for a short period of time for each chunk.  Delivery over each hop should take no more than 32 seconds after the last byte of data is sent.  Clients applications define their own implementation-dependent timers for
end-to-end message delivery.

</p>
<p>
In some cases the end user node may not have its own client or that client or
node may be unavailable. In this case, a message-taker can take receipt of the
message or fragment and deliver a REPORT back to the sender indicating that the
message or fragment was successfully stored.

</p>
<p>
For client to client communication, the sender of a message typically opens a
new TCP connection (with or without TLS) if one is needed.  Relays reuse existing connections first,
but can open new connections (typically to another relay) to deliver requests such as SEND
or REPORT.  Responses can only be sent over existing connections.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;New Protocol Elements</h3>

<a name="rfc.section.4.1"></a><h4><a name="anchor5">4.1</a>&nbsp;The AUTH Method</h4>

<p>
AUTH requests are used by clients with ephemeral addresses to create a
handle they can use to receive incoming requests.  AUTH requests can also
contain credentials used to authenticate a client, and authorization policy used
to block Denial of Service attacks.  AUTH requests are discussed in more detail in Section XXX TODO.

</p>
<p>
In response to an AUTH request, a successful response contains a Path header with a list of URIs that the Client can give to its peers to route responses back to the Client. 

</p>
<a name="rfc.section.4.2"></a><h4><a name="anchor6">4.2</a>&nbsp;The Use-Path header</h4>

<p>
    The Use-Path header is a list of URIs provided by an MSRP Relay in response to a successful AUTH request.  This list of URIs can be used by the MSRP Client that sent the AUTH request to receive MSRP requests, and can advertise this list of URIs, for example in a session description.

</p>
<a name="rfc.section.4.3"></a><h4><a name="anchor7">4.3</a>&nbsp;Authentication headers</h4>

<p>
The Authentication-Info header provides optional information for HTTP Digest authentication.  This header MAY be included in the response to an AUTH request.  Semantics of the header are described in RFC 2617

</p>
<p>
The Authorization header contains authentication credentials for HTTP Digest authentication in an AUTH request. Section [x.y] .   Note that the parameters of this header are separated by commas instead of semicolons.  The presence of commas in this header does not imply that there is more than one header field value for this header field (only one header field value is allowed). Semantics of the header are described in RFC 2617.  This header MUST NOT appear in any parcel other than an AUTH request.

</p>
<p>
The WWW-Authenticate header [more]

</p>
<a name="rfc.section.4.4"></a><h4><a name="anchor8">4.4</a>&nbsp;Time-related headers</h4>

<p>
The Expires header in a provides a relative time after which the action implied by the method of the request is no longer of interest.  In a request, the Expires header indicates how long the sender would like to .  In a response, the Expires header indicates how long the responder considers this information relevant (if the responder [more].  Specifically an Expires header in an AUTH request indicates how long the provided URIs will be valid.

</p>
<p>
The Min-Expires header contains the minimum duration a server will permit in an Expires header.  It is sent only in 423 "Interval Out-of-Bounds" responses.  Likewise the Max-Expires header contains the maximum duration a server will permit in an Expires header.

</p>
<p>
423 Interval Out-of-bounds.  Max-Expires header

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;Procedures</h3>

<a name="rfc.section.5.1"></a><h4><a name="anchor10">5.1</a>&nbsp;Client behavior</h4>

<a name="rfc.section.5.1.1"></a><h4><a name="anchor11">5.1.1</a>&nbsp;Connecting to relays acting on your behalf</h4>

<p>
Clients which want to use the services of a relay or list of relays, need to send an AUTH request to each relay which will act on their behalf. For example, some organizations could deploy an "intra-org" relay and an "extra-org" relay.  A client using these relays opens a connection to the intra-org relay and sends an AUTH request.  response

</p>
<p>
Clients can be configured (typically through discovery or manual provisioning) with a list of relays
they need to use. They MUST be able to form a connection to each relay and send
an AUTH command to get a URI that can be used in route headers. The client can
authenticate the relay by looking at the relay's TLS certificate. The relay MUST
authenticate the client using digest authentication. 

</p>
<p>
The relay will return a URI, or list of URIs, in the Use-Path header of the
response. When using a session-protocol such as SIP, these URIs are used by the client in the path attribute that is sent in
the SDP to setup the session. The same URI can be used for multiple sessions to
send to the client. 

</p>
<p>
<p>
When sending an AUTH request, the client MAY add an Expires header to request a MSRP URI that is valid for no longer that the provided interval.  If an AUTH request returns a 401 Unauthorized request, the client SHOULD fetch the Digest challenge from the WWW-Authenticate header in the response and retry the AUTH request, including an Authorization header with the Digest response.  Unlike in HTTP and SIP, Digest authentication in MSRP is only permitted for AUTH requests.

</p>
Example with two relays on one side. Need to AUTH to first, then use the
supplied route header to AUTH to second thought the first. 


<p> 
NOTE - only auth not auth-int is needed because TLS provides integrity 

</p>
<p>
When a client wishes to use more than one relay, they must AUTH to each relay
they wish to use. Consider a client A, that whishes messages to flow from A to
the first relays, R1, then on to a second relays, R2. This client with do a
normal AUTH with R1. It will then do an AUTH transaction with R2 that is routed
through R1. The client will form this AUTH messages by setting the request URI
to R2 and adding a route header with the URI learned from R1 then sending this
message to R1. R1 will forward this like a REPORT request is forwarded to
R2. 

</p>
<p>
When the client sends an AUTH request, it may set the Expires header a relative
time. The relay will return a URI that is only valid for that periods of
time. 

</p><pre>
auth to-path: intra-org
     from-path: alice@a
200  to-path: alice@a
     from-path: intra-org
     use-path: alice@intra-org/abcd alice@a

auth to-path: alice@intra-org/abcd extra-org
    auth to-path: extra-org
    200 use-path: extra-org/xyzpdq alice@intra-org/abcd alice@a
200 use-path: extra-org/xyzpdq alice@intra-org/abcd alice@a
</pre>

<a name="rfc.section.5.1.2"></a><h4><a name="anchor12">5.1.2</a>&nbsp;Sending requests</h4>

<p>
The procedure for sending SEND, VISIT, and REPORT requests is identical for clients whether relays are involved or not. The specific procedures are described in section TODO of [MSRP].

</p>
<p>
As usual, once the next-hop URI is determined, the client MUST find the appropriate address, port, and transport to use and then check if there is already an existing suitable connection to the next-hop target.  If so, the client MUST send the request over the most suitable connection.  Suitability MAY be determined by a variety of factors such as measured load and local policy, however in most simple implementations a connection will be suitable if it exists and is in an active state.

</p>
<a name="rfc.section.5.1.3"></a><h4><a name="anchor13">5.1.3</a>&nbsp;Receiving Requests</h4>

<p>
The procedure for receiving requests is identical for clients whether relays are involved or not.

</p>
<a name="rfc.section.5.1.4"></a><h4><a name="anchor14">5.1.4</a>&nbsp;Managing Connections</h4>

<p>Clients should open connection whenever they wish to deliver a request and no suitable connection exists.  For client to client connections, a client should close a connection when there are no longer any sessions associated with the connection.  For connections to relays, the client should leave a connection up until no sessions are using the connection for a locally defined period of time, which defaults to 5 minutes for foreign relays and one hour for the client's relays.
</p>
<a name="rfc.section.5.2"></a><h4><a name="anchor15">5.2</a>&nbsp;Relay behavior</h4>

<a name="rfc.section.5.2.1"></a><h4><a name="anchor16">5.2.1</a>&nbsp;Handling Incoming Connections</h4>

<p>
</p>
<a name="rfc.section.5.2.2"></a><h4><a name="anchor17">5.2.2</a>&nbsp;Generic request behavior</h4>

<p>
Upon receiving a new request, relays first verify the validity of the request.

[NO: Relays then tag valid requests with a locally-significant connection identifier which they add to the last URI in the Back-Path header.  This is used to insure that responses can be routed over an existing connection.  ???]
     
Relays then examine the first URI in the To-Path header and remove this URI if it matches a URI corresponding to the relay. 
Authorization -- determine if the final target is a URI under its control or from a URI under its control.

</p>
<a name="rfc.section.5.2.3"></a><h4><a name="anchor18">5.2.3</a>&nbsp;Receiving AUTH requests</h4>

<p>
When a relay receives an AUTH request, it must digest challenge the
request. Once the challenge is complete, it MUST provide a URI that can be used
in future route headers. When the route URI is received in future messages. It
MUST verify that this URI was issues by this relay. It MUST ensure that the
message is either being forwarded from an entity that did the AUTH request that
resulted in this URI or it is being forwarded to the the entity that did the
AUTH request that resulted in this URI.  
</p>
<p>
Discuss forwarding of AUTH requests for another relay

</p>
<p>
The relay does not necessarily needs to save state to meet these
requirements. One way that a relay could implement this is the following. When
an AUTH request arrives, the relay concatenates the current time, the identity
of the sender of the AUTH request, the identity of the previous hop the request
came from. It then takes the concatenates string and encrypts it with a key only
the relay knows and uses this for form the user portion of the sims URI that it
returns.  Later when it receives a URI, it can decrypt this information and use
it to decide if the request should be forwarded or not.  If the relay is
actually several servers that share a DNS name, the URI may also encrypt which
server actually has the connection to the client. 
</p>
<p>
When a relay receive an AUTH request, it must authenticate the client that sent
it with digest, it must also authenticate the previous hop that send the message
to it. When previous hop was a relay this is done with the mutual TLS while when
the previous hop was a client mutual TLS MAY be used it is available or the
client authorization from the digest is used. The relay will generate the base URI of a family of URIs, each of which
allows messages to be forwarded to and from this client. If the
previous hop was authenticated by mutual TLS, then the URI MUST be valid to
route across any connection the relay has to the previous hop relay. If the
previous hop was not authenticated by mutual TLS, then the URI MUST only be
valid to route across the same connection that the AUTH was received on. If this
connection is closed then reopened, the URI MUST NOT be valid. Valid to route
means that when the relay receives a messages that contains this URI, if the
message it going to element that was the previous hop in the AUTH, then the
relay can forward it and if the messages is coming from previous hop in the
AUTH, then the relay can forward it to any location, otherwise the RELAY must
discard the message and MAY send a REPORT indicating the auth URI was bad. If
the AUTH request contains an Expires header, then the relay MUST ensure that the
URI is not valid to route after the expiry time. 

</p>
<p>
    [*** NOTE: Consider moving to another section ***]

</p>
<p>
It is possible to implement all of the above requirements without the relay
saving any state. When a relay starts up it could pick a crypto random 128 bit
password (K) and 128 bit initialization vector (IV). If the relay was actually a
NDS farm, all the machines in the farm would need to share the same K. When an
ATUH request was received the relay form a string that contains: the expiry time
of the URI, an indication if the previous hop was mutual TLS authenticated or
not and it it was, the name of the previous hop, if it was not the identifier
for the connection which received the AUTH request. This string would be padded by appending a byte with the value 0x80 then adding zero or more bytes with the value of 0x00 until the string length is a multiple of 16 bytes long.  A new random IV vector would be
selected (it needs to change because it forms the salt) and the padded string would
be encrypted using AES-CBC with a key of K. The IV and encrypted data and an SPI (security parameter index) that changed each time K changed would be
base 64 encoded and form the user portion of the request URI. The SPI allows the key to be changed and for the system to know which K should be used. Later when the
relay received this URI, it could decrypt it and check the current time was
before the expiry time and check that the messages was coming from or going to
the connection or location specified in the URI. Integrity protection is not required because it is extremely unlikely that random data that was decrypted would result in a valid location that was the same as the messages was routing to or from.  When implementing something
like this, implementers should be careful not to use a scheme like EBE that
would allows portion of encrypted tokens to be cut and paste into others.

</p>
<p>
Note: A successful AUTH response returns a Route header which contains a base MSRP URI that the 
  client can use to create a number of different URIs which are all associated with the current connection.

</p>
<a name="rfc.section.5.2.4"></a><h4><a name="anchor19">5.2.4</a>&nbsp;Forwarding SEND requests</h4>

<p>
A MSRP relay that receives a SEND request MUST respond with a final response
immediately. A 200-class response indicates the successful receipt of a
message fragment, but does not mean that the message has been forwarded on to
its next hop. 

</p>
<p>
The final response to the SEND MUST be sent to the previous hop, which could
be a MSRP relay or the original sender of the SEND request. 

</p>
<p>
The 2xx response to the SEND MUST NOT contain a body. A 4xx or 5xx response
indicates that the message was not delivered successfully.  A 6xx response means
it was delivered successfully, but refused.

</p>
<p>
The MSRP relay MAY further break up the message fragment received in the SEND
request into smaller fragments and forward them to the next hop in separate
SEND requests. It MAY also combine message fragments received before or after
this SEND request, and forward them out in a single SEND request to the
next hop identified in the Hops header. The MSRP relay MUST NOT combine message
fragments from SEND requests with different values in the Message-ID header.

</p>
<p>
The MSRP relay MAY choose whether to further fragment the message, or combine
message fragments, or send the message as is, based on some policy which is
administered, or based on the network speed to the next hop, or any other
mechanism.

</p>
<p>
If the MSRP relay has knowledge of the byte range that it will transmit to the
next hop, it SHOULD update the message/byteranges parameter in the SEND
request appropriately.

</p>
<p>
Before forwarding the SEND request to the next hop, the MSRP relay MUST
inspect the first URI in the To-Path header. If it indicates this
relay, the relay removes this URI from the To-Path header and inserts this URI in the From-Path header before any other URIs. 

</p>
<p>
If the MSRP relay fails to forward the SEND on to the next hop, it SHOULD
return a REPORT back to the sender of the SEND indicating the reason for
failure using the list of URIs in the From-Path header.  [how?  example.  see section]

</p>
<a name="rfc.section.5.2.5"></a><h4><a name="anchor20">5.2.5</a>&nbsp;Forwarding non-SEND requests</h4>

<p>
An MSRP relay that receives any request other than a SEND request (including new methods unknown to the relay), first follows the validation and authorization rules for all requests in Section x.y. Then the relay moves its URI from the beginning of the To-Path header, to the beginning of the From-Path header and forwards the request on to the next hop.

It MUST use the most suitable conection, etc, etc..  If no suitable connection exists, the relay opens a new connection.
    
    

</p>
<a name="rfc.section.5.2.6"></a><h4><a name="anchor21">5.2.6</a>&nbsp;Forwarding Responses</h4>

<p>
    Relays receiving a response, first check the Tr-ID of the response.  If the relay is unaware of this transaction, the response MUST be dropped. Likewise if the message is unparsable, the relay MUST drop the response.  If the response matches an existing transaction, the transaction state MUST be deleted. The relay MUST verify that the first URI in the To-Path corresponds to it. If not, the response SHOULD be dropped. If there are additional URIs in the To-Path header, the relay can then move its URI from the list To-Path header, insert its URI in front of any other URIs in the From-Path header, and forward the response to the next URI in the To-Path header.  The relay sends the request over the best connection which corresponds to the next URI in the To-Path header.  If this connection has closed, then the response is silently discarded.

</p>
<a name="rfc.section.5.2.7"></a><h4><a name="anchor22">5.2.7</a>&nbsp;Managing Connections</h4>

<p>
Relays should keep connection open as long as possible. If a connection has not
been used in a significant time (many minutes) it could be closed. If the relay
runs out of resource and must close connections, it should first stop accepting
new connections from clients then start closing connections on a least recently
used basis. 
</p>
<a name="rfc.section.5.2.8"></a><h4><a name="anchor23">5.2.8</a>&nbsp;Forwarding unknown requests</h4>

<p>
Requests with an unknown method are forwarded as if they were REPORT requests.

</p>
<a name="rfc.section.5.3"></a><h4><a name="anchor24">5.3</a>&nbsp;Acting as a Message Taker</h4>

<p>
A Message Taker merely acts like a Client which returns different REPORT
responses. 
</p>
<p>
TODO - how do I let the message taker know to send all the requests it saved
for me to me. I assume I still send REPORTs to the original sender as well as the
message take to let them know I got the message. 
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;Formal Syntax</h3>

<p>
The following syntax specification uses the augmented Backus-Naur Form (BNF) as
described in <a href="#RFC2234" title="Crocker, D. and P. Overell, Augmented BNF for Syntax Specifications: ABNF, November 1997."quot;">RFC-2234</a>[6].  

</p><pre>

AUTHm           = %x41.55.54.48           ; AUTH in caps
Method          = SENDm / VISITm / REPORTm / AUTHm
                     / extension-method

             /   "401"  ;  Authentication Required
             /   "423"  ;  Interval Out-of-Bounds
             


Authentication-Info  =  "Authentication-Info" HCOLON ainfo
                        *(COMMA ainfo)
ainfo                =  nextnonce / message-qop
                         / response-auth / cnonce
                         / nonce-count
nextnonce            =  "nextnonce" EQUAL nonce-value
response-auth        =  "rspauth" EQUAL response-digest
response-digest      =  LDQUOT *LHEX RDQUOT

Authorization     =  "Authorization" HCOLON credentials
credentials       =  ("Digest" LWS digest-response)
                     / other-response
digest-response   =  dig-resp *(COMMA dig-resp)
dig-resp          =  username / realm / nonce / digest-uri
                      / dresponse / algorithm / cnonce
                      / opaque / message-qop
                      / nonce-count / auth-param
username          =  "username" EQUAL username-value
username-value    =  quoted-string
digest-uri        =  "uri" EQUAL LDQUOT digest-uri-value RDQUOT
digest-uri-value  =  rquest-uri ; Equal to request-uri as specified
                     by HTTP/1.1
message-qop       =  "qop" EQUAL qop-value
cnonce            =  "cnonce" EQUAL cnonce-value
cnonce-value      =  nonce-value
nonce-count       =  "nc" EQUAL nc-value
nc-value          =  8LHEX
dresponse         =  "response" EQUAL request-digest
request-digest    =  LDQUOT 32LHEX RDQUOT
auth-param        =  auth-param-name EQUAL
                     ( token / quoted-string )
auth-param-name   =  token
other-response    =  auth-scheme LWS auth-param
                     *(COMMA auth-param)
auth-scheme       =  token
LHEX              =  DIGIT / %x61-66 ;lowercase a-f
;   Some elements (authentication) force hex alphas to be lower case.

WWW-Authenticate  =  "WWW-Authenticate" HCOLON challenge
challenge           =  ("Digest" LWS digest-cln *(COMMA digest-cln))
                       / other-challenge
other-challenge     =  auth-scheme LWS auth-param
                       *(COMMA auth-param)
digest-cln          =  realm / domain / nonce
                        / opaque / stale / algorithm
                        / qop-options / auth-param
realm               =  "realm" EQUAL realm-value
realm-value         =  quoted-string
domain              =  "domain" EQUAL LDQUOT URI
                       *( 1*SP URI ) RDQUOT
URI                 =  MSRP-URI / anyURI
nonce               =  "nonce" EQUAL nonce-value
nonce-value         =  quoted-string
opaque              =  "opaque" EQUAL quoted-string
stale               =  "stale" EQUAL ( "true" / "false" )
algorithm           =  "algorithm" EQUAL ( "MD5" / "MD5-sess"
                       / token )
qop-options         =  "qop" EQUAL LDQUOT qop-value
                       *("," qop-value) RDQUOT
qop-value           =  "auth" / token
</pre>

<a name="srv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;Finding MSRP Servers</h3>

<p>
    ### FIX ENTIRE SECTION ###

</p>
<p>
When sending a response, the response is always forwarded over an existing
connection using the connection handle set in the receiver parameter in the
topmost Via header field value and the sent-by transport in that Via header
field value to determine the correct connection.

</p>
<p>
When resolving a URI (for example from a Route header field, or from the
Request-URI), examine the hostport portion of the URI and the transport URI
parameter to decide how to proceed.

</p>
<p>
If the hostport is an IPv4 address or an IPv6 reference, send the request to
that address using the port and transport specified in the URI. If no transport
is provided, use the default (tls+tcp).  If no port number is provided, use the
default for the selected protocol (port 8999 for tcp, and port 9000 for tls over
tcp).

</p>
<p>
If the hostport is a domain name and an explicit port number is provided,
attempt to lookup a valid address record (A, AAAA, or A6) for the domain name.
Connect using the specified protocol (or the default of tls+tcp if none is
specified) and port number. 
</p>
<p>
If a domain name is provided, but no port number, perform a <a href="#RFC2782" title="Gulbrandsen, A., Vixie, P. and L. Esibov, A DNS RR for specifying the location of services (DNS SRV), February 2000."quot;">DNS SRV</a>[7] lookup for
all transports supported by the client and select the entry with the highest
weight.  If no SRV records are found, try an address lookup using the default
port number procedures described in the previous paragraph. Note that AUTH
requests MUST only be sent over a TLS-protected channel.  An SRV lookup in the
example.com domain might return: 
</p><pre>
;; in example.com.      Pri Wght Port Target   
_sims+tls._tcp   IN SRV 0   1    9000 server1.example.com.
_sims+tls._tcp   IN SRV 0   2    9000 server2.example.com.
_sims._tcp       IN SRV 1   1    8999 server1.example.com.
_sims._tcp       IN SRV 1   2    8999 server2.example.com.
</pre>

<p>
If implementing a relay farm, it is RECOMMENDED that each member of the relay
farm have an SRV entry.  If any members of the farm have multiple IP addresses
(for example an IPv4 and an IPv6 address), each of these addresses SHOULD be
registered in DNS as separate A, AAAA, or A6 records corresponding to a single
target. 
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;Security Considerations</h3>

<p>
This section first describes the security mechanisms available for use in
MSRP. Then the threat model is presented.  Finally we list implementation
requirements related to security.

</p>
<a name="rfc.section.8.1"></a><h4><a name="anchor27">8.1</a>&nbsp;Using HTTP Authentication</h4>

<p>
AUTH requests SHOULD be authenticated using HTTP authentication.  HTTP
authentication is done as described in [RFC 2617], with the following
exceptions. Basic authentication MUST NOT be used. A qop value of auth-int MUST
NOT be used as the AUTH requests are integrity protected by TLS and there is no
body to protect. Note that unlike in some usages of HTTP Authentication (for
example, SIP), the uri parameter in the Authorize header is the same as the
Request-URI in the request line of the MSRP parcel of the AUTH request.  Note
the BNF in RFC-2617 has an error--the value of the uri parameter MUST be in
quotes. The BNF in this document is correct, as are the examples in RFC
2617.
</p>
<a name="rfc.section.8.2"></a><h4><a name="anchor28">8.2</a>&nbsp;Using TLS</h4>

<p>
TLS is used to authenticate relays to senders and to provide integrity and
confidentiality for the headers being transported. MSRP client and relays MUST
support TLS.  Clients and relays MUST support the TLS ClientExtendedHello
extended hello information for server name indication as described in <a href="#RFC3546" title="Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J. and T. Wright, Transport Layer Security (TLS) Extensions, June 2003."quot;">RFC 3546</a>[8]. A TLS cipher-suite of
<a href="#RFC3268" title="Chown, P., Advanced Encryption Standard (AES) Ciphersuites for Transport Layer Security (TLS), June 2002."quot;">TLS_RSA_WITH_AES_128_CBC_SHA</a>[9] MUST be supported
(other cipher-suites MAY also be suported). Relays must act as TLS servers and
present a certificate with their identity in the SubjectAltName using the choice
type of dnsName. Relay to relay connections MUST use TLS and client to relay
communications MUST use TLS for AUTH requests and responses.

</p>
<a name="rfc.section.8.3"></a><h4><a name="anchor29">8.3</a>&nbsp;Threat Model</h4>

<p>
This section discuses the threat model and the broad mechanism that must come
into place to secure the protocol. The next section describes the details of how
the protocol mechanism meet the broad requirements.  
</p>
<p>
MSRP allows two peer to peer clients to exchange messages. Each peer can select
a set of relays to perform certain policy operation for them. This combined set
of relays is referred to as the route set. There often exists a channel outside
of MSRP, such as out-of-band provisioning or an explicit rendezvous protocol
such as SIP, that can securely negotiate setting up the MSRP session and
communicate the route set to both clients. A client may trust a relay with
certain types of routing and policy decisions but it might or might not trust
the relay with all the contents of the session. For example, a relay being
trusted to look for viruses would probably need to be allowed to see all the
contents of the session. A relay that helped deal with firewall traversal of the
ISPs firewall would likely not be trusted with the contents of the session but
would be trusted to correctly forward information.  
</p>
<p>
Clients need to be able to authenticate that the relay they are communicating
with is the one they trust. Likewise, relays need to be able to authenticate the
client is the authorized client for them to forward information to. Clients need
the option of ensuring information between the relay and the client is integrity
protected and confidential to elements other than the relays and clients. To
simplify the number of options, traffic between relays must always be integrity
protected and encrypted regardless of if the client request it or not. There is
no way for the clients to tell the relays what strength of crypto to use between
relays other than the clients to choose to use relays that are operated by
people requiring an adequate level of security. 
</p>
<p>
The system also need to stop the messages from being directed to relays that are
not supposed to see them. To keep the relays from being used in DDoS attacks,
the relays must not forward messages unless they have a trust relationship with
either the client sending or receiving the message and that they only forward
that message if it is coming from or going to the client they have the trust
relationship with. If a relay has a trust relationship with the client that is
the destination of the message, it should not send the message anywhere except
the client that is the destination. 
</p>
<p>
Some terminology used in this discussion is SClient is the client sending a
message and RClient is the client receiving a message. SRelay is a relay the
sender trusts and RRelay is a relay the receiver trusts. The message will go
from SClient to SRelay1 to SRelay2 to RRelay2 to RRelay1 to RClient.  
</p>
<a name="rfc.section.8.4"></a><h4><a name="anchor30">8.4</a>&nbsp;Security Mechanism </h4>

<p> Confidentiality and Privacy from elements not in the route set is provided
by using TLS on all the transports. If a client decided to not use TLS that is
it's choice but relays must use TLS. Clients must implement TLS. 
</p>
<p>
The relays authenticate to the clients using TLS (but don't have to do mutual
TLS). The clients authenticate to the relays using HTTP Digest inside of
TLS. Relays authenticate to each other using mutual TLS.
</p>
<p>
The clients can protect the contents so that the relays can not see them by
using S/MIME encryption. End to end signing is also possible with S/MIME. 
</p>
<p>
The complex part is making sure that relays do not send messages place where
they should not. This is done by having the client authenticate to the relay and
having the relay return a token. Messages that contain this token can be relayed
if they come from the client that got the token or if they are being forwarded
towards the client that got the token. The tokens must only ever be seen by
things in the route set or other elements that at least one of the parties
trusts.  If some 3rd party discovers the token that RRelay2 uses to forward
messages to RClient, then that 3rd party can send as many messages as they want
to RRelay2 and it will forward them to RClient. The 3rd party can not cause them
to be forwarded anywhere except to RClient eliminating the open relay
problems. SRelay1 will not forward the message unless it contains a valid
token. 
</p>
<p>
When SClient goes to get a token from SRelay2, this request is relayed through
SRelay1. SRelay authenticates that it really is SClient requesting the token but
it generates a token that is only valid for forwarding messages to or from
SRelay1. SRelay two knows it is connected to SRelay1 because of the mutual
TLS. 
</p>
<p>
The tokens are carried in the user portion of the MSRP URLs.
</p>
<p>
Issues: How to tokens expire - rekeying. Will probably use Expire header on AUTH
response. Token MAY be valid for between 10 minutes and 24 hours with 1 hour
recommended. Both sides need to do a SIP re-invite to set up new tokens before
the old one expires. 
</p>
<p>
Issues: Token good for single session or for all session 
</p>
<p>
Note: tokens are only required for relays, not clients or note takers. 
</p>
<p>
TODO talk about example from client to client and from Client A, then to a relay
that A uses, RA, then on to client B. 
</p>
<a name="rfc.section.8.5"></a><h4><a name="anchor31">8.5</a>&nbsp;Preventing Spam and Denial of Service Attacks</h4>

<p>
While this specification already implements a number of significant improvements to prevent unsolicited messaging and Denial of Service, additional mechanisms are envisioned being useful in the future.  The 402 Payment Required and 409 Puzzle Required response codes are reserved for future use and may be useful to further discourage unsolicited messages.

</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;IANA Considerations</h3>

<p>
This document introduces no requirements for IANA.
     
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;Example SDP with multiple hops</h3>

<p>
A sample SDP offer for a MSRP session could look like:

</p><pre>
c=IN IP4 invalid.none
 m=message 1234 msrp/tcp alice@alice.example.com
 a=accept: message/cpim text/plain text/html
 a=hop:msrp:magic456@a.example.com:1234;transport=tcp

</pre>

<p>
In this offer Alice wishes to receive MSRP messages at
alice@alice.example.com. She wants to use TCP as the transport for the MSRP
session. She can accept message/cpim, text/plain and text/html message boldies
in SEND requests. She wishes to use the relay msrp:magic456@a.example.com for
the MSRP session.

</p>
<p>
To this offer, Bob's answer could look like:

</p><pre>
c=IN IP4 invalid.none
 m=message 1234 msrp/tcp bob@bob.example.com
 a=accept: message/cpim text/plain
 a=hop:msrp:magic789@b1.example.com:1234;transport=tcp
 a=hop:msrp:magic012@b2.example.com:1234;transport=tcp

</pre>

<p>
Here Bob has agreed to use tcp as the transport, and wishes to receive the
MSRP messages at bob@bob.example.com. He can accept only message/cpim and
text/plain message bodies in SEND requests and has rejected text/html offer
made by Alice. He wishes to use two relays for the MSRP session -
msrp:magic789@b1.example.com and msrp:magic012@b2.example.com.

</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;Acknowledgments</h3>

<p>
Many thanks to the following members of the SIMPLE WG for spirited discussions on session mode:  Ben Campbell, Jonathan Rosenberg, Robert Sparks, Paul Kyzivat, Allison Mankin, Jon Peterson,  Brian Rosen, Dean Willis, Adam Roach, Aki Niemi, Hisham Khartabil, Juhee Garg, Pekka Pessi, and Chris Boulton 

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[1]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997 (<a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[2]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M. and E. Schooler, "<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2246">[3]</a></td>
<td class="author-text"><a href="mailto:tdierks@certicom.com">Dierks, T.</a>, <a href="mailto:callen@certicom.com">Allen, C.</a>, <a href="mailto:treese@openmarket.com">Treese, W.</a>, Karlton, P., <a href="mailto:freier@netscape.com">Freier, A.</a> and <a href="mailto:pck@netcom.com">P. Kocher</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2246.txt">The TLS Protocol Version 1.0</a>", RFC 2246, January 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2617">[4]</a></td>
<td class="author-text"><a href="mailto:john@math.nwu.edu">Franks, J.</a>, <a href="mailto:pbaker@verisign.com">Hallam-Baker, P.</a>, <a href="mailto:jeff@AbiSource.com">Hostetler, J.</a>, <a href="mailto:lawrence@agranat.com">Lawrence, S.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, Luotonen, A. and <a href="mailto:stewart@OpenMarket.com">L. Stewart</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2617.txt">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, June 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[5]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a> and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999 (<a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2234">[6]</a></td>
<td class="author-text"><a href="mailto:dcrocker@imc.org">Crocker, D.</a> and <a href="mailto:paulo@turnpike.com">P. Overell</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2234.txt">Augmented BNF for Syntax Specifications: ABNF</a>", RFC 2234, November 1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[7]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P. and <a href="mailto:levone@microsoft.com">L. Esibov</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">A DNS RR for specifying the location of services (DNS SRV)</a>", RFC 2782, February 2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3546">[8]</a></td>
<td class="author-text">Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J. and T. Wright, "<a href="ftp://ftp.isi.edu/in-notes/rfc3546.txt">Transport Layer Security (TLS) Extensions</a>", RFC 3546, June 2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3268">[9]</a></td>
<td class="author-text">Chown, P., "<a href="ftp://ftp.isi.edu/in-notes/rfc3268.txt">Advanced Encryption Standard (AES) Ciphersuites for Transport Layer Security (TLS)</a>", RFC 3268, June 2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[10]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2045.txt">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>", RFC 2045, November 1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2046">[11]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2046.txt">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>", RFC 2046, November 1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2633">[12]</a></td>
<td class="author-text"><a href="mailto:blaker@deming.com">Ramsdell, B.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2633.txt">S/MIME Version 3 Message Specification</a>", RFC 2633, June 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2396">[13]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@ics.uci.edu">Fielding, R.</a> and <a href="mailto:masinter@parc.xerox.com">L. Masinter</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2396.txt">Uniform Resource Identifiers (URI): Generic Syntax</a>", RFC 2396, August 1998 (<a href="http://xml.resource.org/public/rfc/html/rfc2396.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2396.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1123">[14]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc1123.txt">Requirements for Internet Hosts - Application and Support</a>", STD 3, RFC 1123, October 1989.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2183">[15]</a></td>
<td class="author-text"><a href="mailto:rens@century.com">Troost, R.</a>, <a href="mailto:sdorner@qualcomm.com">Dorner, S.</a> and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2183.txt">Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</a>", RFC 2183, August 1997 (<a href="http://xml.resource.org/public/rfc/html/rfc2183.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2183.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2327">[16]</a></td>
<td class="author-text"><a href="mailto:mjh@isi.edu">Handley, M.</a> and <a href="mailto:van@ee.lbl.gov">V. Jacobson</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2327.txt">SDP: Session Description Protocol</a>", RFC 2327, April 1998 (<a href="http://xml.resource.org/public/rfc/html/rfc2327.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2327.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3264">[17]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, "<a href="ftp://ftp.isi.edu/in-notes/rfc3264.txt">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3458">[18]</a></td>
<td class="author-text">Burger, E., Candell, E., Eliot, C. and G. Klyne, "<a href="ftp://ftp.isi.edu/in-notes/rfc3458.txt">Message Context for Internet Mail</a>", RFC 3458, January 2003.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.mahy-simple-why-session-mode">[19]</a></td>
<td class="author-text">Mahy, R., "<a href="http://www.ietf.org/internet-drafts/draft-mahy-simple-why-session-mode-00.txt.txt">Benefits of Session-Mode Instant Messaging</a>", draft-mahy-simple-why-session-mode-00.txt (work in progress), February 2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-simple-message-sessions">[20]</a></td>
<td class="author-text">Campbell, B., "<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-message-sessions-02.txt">Instant Message Sessions in SIMPLE</a>", draft-ietf-simple-message-sessions-02 (work in progress), Oct 2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-impp-cpim-msgfmt">[21]</a></td>
<td class="author-text">Atkins, D. and G. Klyne, "<a href="http://www.ietf.org/internet-drafts/draft-ietf-impp-cpim-msgfmt-08.txt">Common Presence and Instant Messaging: Message Format</a>", draft-ietf-impp-cpim-msgfmt-08 (work in progress), January 2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2326">[22]</a></td>
<td class="author-text"><a href="mailto:schulzrinne@cs.columbia.edu">Schulzrinne, H.</a>, <a href="mailto:anup@netscape.com">Rao, A.</a> and <a href="mailto:robla@real.com">R. Lanphier</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2326.txt">Real Time Streaming Protocol (RTSP)</a>", RFC 2326, April 1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2392">[23]</a></td>
<td class="author-text"><a href="mailto:XIson@cnj.digex.net">Levinson, E.</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2392.txt">Content-ID and Message-ID Uniform Resource Locators</a>", RFC 2392, August 1998 (<a href="http://xml.resource.org/public/rfc/html/rfc2392.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2392.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2779">[24]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a> and <a href="mailto:jesse@intonet.com">J. Vincent</a>, "<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">Instant Messaging / Presence Protocol Requirements</a>", RFC 2779, February 2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2822">[25]</a></td>
<td class="author-text">Resnick, P., "<a href="ftp://ftp.isi.edu/in-notes/rfc2822.txt">Internet Message Format</a>", RFC 2822, April 2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.mahy-simple-session-relay-reqs">[26]</a></td>
<td class="author-text">Mahy, R., "<a href="http://www.ietf.org/internet-drafts/draft-mahy-simple-session-relay-reqs-00.txt.txt">Relay Requirements for Session-Mode Instant Messaging</a>", draft-mahy-simple-session-relay-reqs-00.txt (work in progress), February 2004.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cullen Jennings</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">MS: SJC-21/2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 527-9132</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rohan Mahy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5617 Scotts Valley Drive, Suite 200</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scotts Valley, CA  95066</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:rohan@cisco.com">rohan@cisco.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="bug" align="right"><tr><td class="bug"><a href="#toc" class="link2">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Intellectual Property Statement</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of
any intellectual property or other rights that might be claimed
to  pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; neither does
it represent that it has made any effort to identify any such
rights. Information on the IETF's procedures with respect to
rights in standards-track and standards-related documentation
can be found in BCP-11. Copies of claims of rights made
available for publication and any assurances of licenses to
be made available, or the result of an attempt made
to obtain a general license or permission for the use of such
proprietary rights by implementors or users of this
specification can be obtained from the IETF Secretariat.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its
attention any copyrights, patents or patent applications, or
other proprietary rights which may cover technology that may be
required to practice this standard. Please address the
information to the IETF Executive Director.</p>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright (C) The Internet Society (2004). All Rights Reserved.</p>
<p class='copyright'>
This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it
or assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are
included on all such copies and derivative works. However, this
document itself may not be modified in any way, such as by removing
the copyright notice or references to the Internet Society or other
Internet organizations, except as needed for the purpose of
developing Internet standards in which case the procedures for
copyrights defined in the Internet Standards process must be
followed, or as required to translate it into languages other than
English.</p>
<p class='copyright'>
The limited permissions granted above are perpetual and will not be
revoked by the Internet Society or its successors or assignees.</p>
<p class='copyright'>
This document and the information contained herein is provided on an
&quot;AS IS&quot; basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.</p>
<h3>Acknowledgment</h3>
<p class='copyright'>
Funding for the RFC Editor function is currently provided by the
Internet Society.</p>
</body></html>
