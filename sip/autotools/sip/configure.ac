dnl Process this file with autoconf to produce a configure script.

AC_PREREQ(2.57)

AC_INIT([resiprocate/SipStack.hxx],, [resiprocate-devel@list.sipfoundry.org])

dnl
dnl Release Version
dnl
RESIP_MAJOR_VERSION=0
RESIP_MINOR_VERSION=5
RESIP_MICRO_VERSION=0

RESIP_VERSION=$RESIP_MAJOR_VERSION.$RESIP_MINOR_VERSION.$RESIP_MICRO_VERSION
#
#LIBRESIP_SO_VERSION=`expr $RESIP_MINOR_VERSION + $RESIP_MAJOR_VERSION`:$RESIP_MICRO_VERSION:$RESIP_MINOR_VERSION
# This SO version IS NOT related to the release (0.5.0) versions AT ALL.
# This needs to increment independently when the ABI to the library changes.
#
LIBRESIP_SO_VERSION=0:5:0


VERSION=$RESIP_VERSION
PACKAGE=resiprocate

AC_SUBST(RESIP_VERSION)
AC_SUBST(RESIP_MAJOR_VERSION)
AC_SUBST(RESIP_MINOR_VERSION)
AC_SUBST(RESIP_MICRO_VERSION)
AC_SUBST(LIBRESIP_SO_VERSION, $LIBRESIP_SO_VERSION)

AC_MSG_RESULT([Configuring ${PACKAGE} ${VERSION}])


AC_CONFIG_SRCDIR([resiprocate/config.hxx.in])
AC_CONFIG_HEADER([resiprocate/config.hxx])
AM_INIT_AUTOMAKE($PACKAGE, $VERSION)

dnl AC_DISABLE_STATIC

AC_REVISION($Revision:$)

AM_MAINTAINER_MODE

AC_LANG(C++)

AC_PROG_CXX

AC_MSG_CHECKING([ for GNU warning flags])

if test "${GXX}"x = yesx; then
        CXXFLAGS="${CXXFLAGS} -Wall -Wno-deprecated"
        CFLAGS="${CFLAGS} -Wall -Wno-deprecated"
        AC_MSG_RESULT([yes])
else
        AC_MSG_RESULT([no])
fi

AC_PROG_INSTALL
AC_PROG_MAKE_SET
dnl AC_PROG_RANLIB

AC_PROG_LIBTOOL

AC_CHECK_HEADERS([sys/sockio.h sys/int_types.h netinet/in.h sys/socket.h ])
AC_CHECK_HEADER([popt.h],[AC_DEFINE([HAVE_POPT_H],[1],[ Has popt.h ]) LIBS="$LIBS -lpopt"])

AC_CHECK_STRUCT_FOR([
#include <sys/stat.h>
        ],
         stat,
         st_atime,
        [HAVE_ST_ATIME], )


dnl This is ugly, because I'm not an autoconf guru, but it works.
dnl Check for the type of socklen_t.
dnl Still thinking about how to incorporate the results into the code.

AC_CHECK_TYPE(socklen_t,
         AC_DEFINE([HAVE_SOCKLEN_T],[1],[ Has socklen_t ]), 
        [],
        [
#ifdef HAVE_SYS_TYPES_H
# include <sys/types.h>
#endif
#ifdef HAVE_SYS_SOCKET_H
#include <sys/socket.h>
#endif
]
        )

dnl Check for BSD socklen_t if we couldn't do it before.

if test $ac_cv_type_socklen_t = no; then
        unset ac_cv_type_socklen_t
        AC_CHECK_TYPE(socklen_t,
        AC_DEFINE([_BSD_SOCKLEN_T_],[int], [Needs BSD socklen_t]),
        [],
        [
#ifdef HAVE_SYS_TYPES_H
# include <sys/types.h>
#endif
# define _BSD_SOCKLEN_T_ int
#ifdef HAVE_SYS_SOCKET_H
# include <sys/socket.h>
#endif        
        ]
        )
fi

RESIP_LIB_OPENSSL
RESIP_LIB_ARES
RESIP_PROG_DISTCC
RESIP_IPV6
RESIP_SCANNER
RESIP_SCANNER_DEBUG
RESIP_EXCEPTION_DEBUG_LOGS
RESIP_SELECT_CONTENTS

AC_DEFINE_UNQUOTED([RESIP_VERSION], 
        ["$RESIP_VERSION"],
         [The version number of resip])

AC_DEFINE_UNQUOTED([RESIP_MAJOR_VERSION],
         [$RESIP_MAJOR_VERSION],
         [The major version number of resip])

AC_DEFINE_UNQUOTED([RESIP_MINOR_VERSION],
         [$RESIP_MINOR_VERSION], 
        [The minor version number of resip])

AC_DEFINE_UNQUOTED([RESIP_MICRO_VERSION],
         [$RESIP_MICRO_VERSION], 
        [The micro version number of resip])


dnl Test for pthreads.

ACX_PTHREAD

AC_MSG_RESULT([Pthreads flags are : $PTHREAD_LIBS])

dnl LIBS="$PTHREAD_LIBS $LIBS"
dnl CFLAGS="-Wall -Wnodeprecated $CFLAGS $PTHREAD_CFLAGS"

dnl CC="$PTHREAD_CC"

dnl Temporary hack until proper, portable pthreads detection is added.
LIBS="$LIBS -lpthread"



AC_CONFIG_FILES([Makefile resiprocate/Makefile resiprocate/test/Makefile resiprocate/dum/Makefile])  

AC_OUTPUT
